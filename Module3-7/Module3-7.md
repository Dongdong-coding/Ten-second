* **다음 지시를 그대로 구현하라. 너는 표준 라이브러리만 쓰는 Python 3.11 시니어 엔지니어다. `module_3_7` 패키지를 생성하고, 오직 3-2의 `norm_clauses.json`(예: `id, index_path, text, normalized_text, title, tags, category, subcategory, canonical_terms, def_bindings`), 3-4의 `hits.json`(예: `rule_id, clause_id, match_type, spans, strength`), 3-6의 `scores.json`(예: `clause_id, confidence, risk_flag, adopted_rules[], reasons[]`) 그리고 3-3의 `ruleset_runtime.json`(정책/플래그/메타 포함)을 입력으로만 참조하여 교차조항 컨텍스트 리졸버(3-7) 를 구현하라. 3-7은 문서 텍스트를 새로 파싱하지 않고(3-1 침범 금지), 용어 정규화/온톨로지/스코어 산출을 재수행하지 않으며(3-2/3-4/3-6 침범 금지), 규칙 의미를 변경하지 않는다(3-3 침범 금지). 목적은 각 조항의 “기본 위험 판단(3-6 결과)”에 대해 문서 내 다른 조항·부속서·정의조가 주는 맥락(상충·우선·예외·의존)을 식별하고, 이를 구조화된 관계와 “권고용 컨텍스트 위험 플래그”로 주석화하는 것이다.**  
* **패키지 구조는 `module_3_7/resolver.py`(핵심 로직), `module_3_7/policy.py`(컨텍스트 규칙/우선순위 정책 로더), `module_3_7/schemas.py`(데이터 모델), `module_3_7/cli.py`(입출력), `tests/test_resolver.py`(골든셋/경계 테스트), `samples/{norm_clauses.json,hits.json,scores.json,ruleset_runtime.json,policy.json}`으로 구성하라. CLI는 `python -m module_3_7.cli --clauses norm_clauses.json --hits hits.json --scores scores.json --rules ruleset_runtime.json --out context_resolutions.json --policy policy.json`을 제공한다.**  
* **동작 개요: (1) 3-2 산출을 이용해 조항 그래프를 구성한다. 노드는 `clause_id`, 엣지는 `RELATION{type, source, target}`로 표현하며, 기본 타입은 `REF_ARTICLE(제N조 참조)`, `NOTWITHSTANDING(“…에도 불구하고”)`, `SUBJECT_TO(“…에 따르되/따른다”)`, `ANNEX_REF(부속서/별첨/별표)`, `DEFINITION_LINK(정의어→용어 바인딩)`, `EXCEPTION_LINK(다만/단, 다른 조항을 전제로 한 예외)`를 지원한다. 3-2가 부여한 `tags`와 `normalized_text`에서 다음 패턴을 정규식으로만 탐지하라: `제\\s*\\d+\\s*조`, `불구하고`, `따르되|따른다`, `부속서|별첨|별표|부록`, `다만|단,`. (2) 3-3의 정책(`policy.json`)에 정의된 컨텍스트 규칙을 적용한다. 규칙은 JSON 테이블로 제공되며 예시는 다음과 같다:**  
   **`{"overrides":[{"when":{"this.category":"RIGHTS.SUBLEASE_ASSIGN","this.phrase":"허용|승낙","target.category":"RIGHTS.SUBLEASE_ASSIGN","edge":"NOTWITHSTANDING"},"effect":"MITIGATE"}], "subject_to":[{"when":{"this.category":"MONEY.LATE_FEE","edge":"SUBJECT_TO","target.category":"MONEY.RENT"},"effect":"BOUND_BY"}], "annex":[{"when":{"edge":"ANNEX_REF"},"effect":"DETAIL_IN_ANNEX"}]}`. (3) 각 조항별로 3-6의 `risk_flag/confidence`를 \*\*기본값(base\_risk)\*\*으로 보존한 뒤, 그래프·정책을 이용해 맥락 효과를 계산한다. 효과 유형은 `OVERRIDE(상위조항 우선)`, `MITIGATE(상쇄/완화)`, `BOUND_BY(다른 조항에 종속)`, `CONFLICT(모순)`, `DEPEND(의존)`으로 한정한다. (4) 효과가 존재할 때만 권고용 컨텍스트 위험 플래그(contextual\_risk\_flag) 를 산출하되, 3-6의 점수/임계는 변경하지 않는다. 컨텍스트 플래그 결정 규칙은 정책에서 읽어오며 기본은 다음과 같다: `OVERRIDE` → 한 단계 완화(HIGH→WARN, WARN→OK), `MITIGATE` → 임계에 `mitigate_bonus=0.05`를 가정해 한 단계 완화 가능, 단 상대 조항의 confidence ≥ 0.80이어야 한다, `CONFLICT` → `AMBIG` 권고, `BOUND_BY` → 변경 없음, `DEPEND` → 증거 부족 시 `AMBIG` 권고. 완화/강화는 권고 플래그에만 반영하고 `base_risk`는 그대로 둔다.**  
* **출력 스키마는 `ContextResolution{ clause_id, base_risk_flag, base_confidence, contextual_risk_flag?, effects:[{type, target_clause_id, rationale, evidence?:{source_snippet?, target_snippet?}}], relations:[{type, target_clause_id, cue?:\"불구하고|따르되|부속서\"}], policy_notes[], graph_degree:{out,in} }` 리스트와, 파일 상단 `summary{counts_by_effect, changed_flags, unchanged_flags}`를 포함한다. 스니펫이 필요하면 3-5의 evidence가 있을 때 해당 `clause_id`에서 (가능하면 `adopted_rules`와 일치하는) 스니펫을 끌어오고, 없으면 `normalized_text`에서 문장 중심 120–300자를 생성하되 민감정보를 간단 정규식으로 마스킹하라(계좌/주민/전화/이메일). 결정론 보장을 위해 모든 정렬은 `(effect_priority, clause_id, target_clause_id)` 고정 키를 사용한다.**  
* **정책/우선순위: `effect_priority`는 `OVERRIDE > CONFLICT > MITIGATE > BOUND_BY > DEPEND`로 고정하고, 엣지 경쟁 시 더 구체적 참조(정확한 제N조 언급) 를 우선한다. “전 조항/본 조” 같은 모호 참조는 낮은 신뢰로 분류하고 완화 적용 요건을 강화한다. 다중 효과가 동시에 성립해도 가장 보수적 결과를 권고한다(예: `CONFLICT`가 있으면 `MITIGATE` 무시). 모든 임계/보너스 값은 `policy.json`으로 오버라이드할 수 있다:**  
   **`{"thresholds":{"mitigate_conf_min":0.80},"priorities":["OVERRIDE","CONFLICT","MITIGATE","BOUND_BY","DEPEND"],"phrases":{"notwithstanding":"불구하고","subject_to":"따르되|따른다"}}`.**  
* **성능 가드레일: 200KB 문서, 500개 조항, 엣지 2천 개 기준 전체 처리 ≤150ms, 피크 메모리 ≤100MB. 외부 패키지 금지, 정규식은 미리 컴파일할 것. 어떤 단계에서도 3-1/3-2/3-3/3-4/3-5/3-6의 산출을 변경하거나 재계산하지 말라.**  
* **수락 기준: (1) 샘플 임대차 문서에서 `NOTWITHSTANDING`(“제X조에도 불구하고”)가 정확히 우선으로 기록되고 대상 조항 위험에 `OVERRIDE` 효과가 권고로 반영된다. (2) 부속서 참조가 있는 조항은 `ANNEX_REF`가 생성되고 `DETAIL_IN_ANNEX` 메모가 붙는다. (3) 전대 금지 조항과 “임대인 동의 시 전대 허용” 조항이 공존하면 `MITIGATE` 효과가 기록되고, 완화 요건(confidence ≥ 0.80)을 만족할 때만 `contextual_risk_flag`가 낮아진다. (4) 모순되는 기간/해지 조항이 존재하면 `CONFLICT`가 기록되고 `AMBIG` 권고가 발생한다. (5) 동일 입력에서 결과는 항상 결정론적으로 동일하다(난수/시계 의존 금지).**  
* **마지막으로, 어떤 출력도 LLM 호출을 전제로 하지 말고(게이트는 3-8의 역할), 3-7은 그래프와 권고 메타만 제공한다.**  
* 

